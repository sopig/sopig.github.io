<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Appä¸Extensionsé—´é€šä¿¡å…±äº«æ•°æ® Â· xiao</title><meta name="description" content="A Blog Powered By Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">Home</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   Blog</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2015/04/06/2015-04-06-Communication-between-your-App-and-Extensions/" class="post-title-link">Appä¸Extensionsé—´é€šä¿¡å…±äº«æ•°æ®</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/tags/iOS/" class="post-tag-link">iOS</a></li><li class="post-tag-item"><a href="/tags/Swift/" class="post-tag-link">Swift</a></li><li class="post-tag-item"><a href="/tags/AppGroups/" class="post-tag-link">AppGroups</a></li><li class="post-tag-item"><a href="/tags/App-Extensions/" class="post-tag-link">App Extensions</a></li></ul><div class="post-time">Monday, April 6th 2015</div></div><div class="post-content"><p>æœ€è¿‘ç©äº†ç©ï£¿Watchå¼€å‘ï¼Œè€Œç›®å‰ï£¿Watchçš„ä¸»è¦é€»è¾‘å¤„ç†éƒ½æ˜¯æ”¾åœ¨WatchKit Extensionã€‚çœŸæ­£çš„Host Appï¼Œä¹Ÿå°±æ˜¯WatchKit Appåªæ˜¯ç”¨æ¥åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºæ•°æ®çš„ã€‚äºæ˜¯å®è·µäº†ä¸‹containing appä¸app extensionä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®å…±äº«ã€‚  </p>
<a id="more"></a>
<p>##App Groups &amp; Framework</p>
<p>è¿™ä¸¤æ ·å…µå™¨å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ã€‚æƒ³è¦å…±äº«æ•°æ®å°±éœ€è¦å¼€å¯App Groupsï¼Œç»™groupèµ·ä¸€ä¸ªé£éªšçš„åå­—ï¼Œè¿™æ ·æ— è®ºæ˜¯<code>NSUserDefaults</code>è¿˜æ˜¯<code>NSFileManager</code>éƒ½èƒ½é€šè¿‡App Groupså…±äº«æŒä¹…å±‚æ•°æ®äº†ã€‚Core Dataä¹Ÿéœ€è¦<code>NSFileManager</code>æä¾›å­˜å‚¨çš„URLæ”¯æŒï¼Œè€Œå­˜å–Core Dataä¸­çš„æ•°æ®éœ€è¦å¤§é‡çš„æ¨¡æ¿ä»£ç ï¼Œåœ¨æŒä¹…å±‚æ–‡ä»¶å…±äº«ä¹‹åï¼Œä»£ç ä¹Ÿåº”è¯¥åšåˆ°å…±äº«ï¼Œæ‰€ä»¥å°†èƒ½å¤Ÿé‡ç”¨çš„ä»£ç æ‰“åŒ…æˆFrameworkå°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚(é™¤éæ˜¯ä¸ºäº†åšæ¯•è®¾å‡‘ä»£ç é‡)  </p>
<p>è¿˜æ˜¯ä»¥<a href="https://github.com/yulingtianxia/HardChoice" target="_blank" rel="external">HardChoice</a>ä¸ºä¾‹ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªç±»å‹ä¸ºCocoa Touch Frameworkçš„targetï¼Œåå­—å«DataKitã€‚æ–°å»ºä¸€ä¸ªDataAccess.swiftæ–‡ä»¶å¹¶å°†ä»¥å‰AppDelegate.swiftä¸­è‡ªåŠ¨ç”Ÿæˆçš„Core Dataæ¨¡ç‰ˆä»£ç è½¬ç§»è¿‡æ¥ã€‚å¾—ç›ŠäºSwift1.2çš„æ”¹è¿›ï¼Œæ„é€ ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼å˜å¾—æ— æ¯”ç®€å•ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">private static let instance = DataAccess()</div><div class="line">public class var sharedInstance : DataAccess &#123;</div><div class="line">   return instance</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„Swiftçš„æƒé™æ§åˆ¶é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æš´æ¼ç»™æ¡†æ¶ä½¿ç”¨è€…çš„å…¬å¼€æ¥å£å’Œå±æ€§å‰åŠ ä¸Š<code>public</code>å…³é”®å­—ä¿®é¥°ã€‚  </p>
<p>ä¸ºäº†å®ç°Core DataæŒä¹…å±‚å…±äº«ï¼Œéœ€è¦ä¿®æ”¹åŸå…ˆçš„<code>applicationDocumentsDirectory</code>å±æ€§ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">lazy var applicationDocumentsDirectory: NSURL = &#123;</div><div class="line">   // The directory the application uses to store the Core Data store file. This code uses a directory named &quot;com.yxy.iCloudCoreDataTest&quot; in the application&apos;s documents Application Support directory.</div><div class="line">   //        let urls = NSFileManager.defaultManager().URLsForDirectory(.DocumentDirectory, inDomains: .UserDomainMask)</div><div class="line">   //        return urls[urls.count-1] as! NSURL</div><div class="line">   var sharedContainerURL:NSURL? = NSFileManager.defaultManager().containerURLForSecurityApplicationGroupIdentifier(appGroupIdentifier)</div><div class="line">   return sharedContainerURL ?? NSURL()</div><div class="line">   &#125;()</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œ<code>containerURLForSecurityApplicationGroupIdentifier</code>æ–¹æ³•èµ·åˆ°äº†è‡³å…³ä½œç”¨ã€‚  </p>
<p>åŒæ ·èƒ½å¤Ÿå…±äº«çš„ä»£ç å°±æ˜¯Modelå±‚ï¼Œå®ƒä»¬éƒ½æ˜¯<code>NSManagedObject</code>çš„å­ç±»ï¼Œç”¨äºå­˜å‚¨Core Dataä¸­çš„æ•°æ®å®ä¾‹ã€‚åœ¨æŠŠå®ƒä»¬ä»åŸæ¥çš„ä½ç½®æ‹–æ‹½è¿‡æ¥æ—¶åˆ«å¿˜äº†æ›´æ”¹ä¸‹æ–‡ä»¶çš„targetï¼šâ€File inspectorâ€-&gt;â€Target Membershipâ€ï¼Œé€‰ä¸­DataKitã€‚  </p>
<p>åœ¨å¤„ç†iCloudä¸Core DataåŒæ­¥æ•°æ®æ—¶ï¼Œæˆ‘å¯¹<code>NSPersistentStoreCoordinatorStoresWillChangeNotification</code>ã€<code>NSPersistentStoreCoordinatorStoresDidChangeNotification</code>å’Œ<code>NSPersistentStoreDidImportUbiquitousContentChangesNotification</code>è¿™ä¸‰ä¸ªæ•°æ®æ›´æ–°çš„é€šçŸ¥è¿›è¡Œäº†è§‚å¯Ÿå’Œå¤„ç†ï¼Œä½†æ˜¯å†™åœ¨äº†<code>persistentStoreCoordinator</code>è®¡ç®—å±æ€§çš„getæ–¹æ³•ä¸­ã€‚ç°åœ¨ä½¿ç”¨<code>lazy</code>å…³é”®å­—è¿›è¡Œæƒ°æ€§åŠ è½½ï¼Œå¯¼è‡´å¯¹è¿™ä¸‰ä¸ªæ•°æ®æ›´æ–°é€šçŸ¥çš„è§‚å¯Ÿå»¶åï¼Œè¿™ä¼šå¼•å‘ä¸¥é‡çš„é”™è¯¯ã€‚æ‰€ä»¥éœ€è¦å°†é‚£ä¸‰ä¸ª<code>addObserverForName(name, object, queue, usingBlock)</code>æ–¹æ³•æŒªåˆ°<code>init()</code>æ–¹æ³•ä¸­ï¼Œåœ¨ç¬¬ä¸€æ—¶é—´è§‚å¯Ÿé€šçŸ¥ã€‚</p>
<p>æœ€ååœ¨AppDelegate.swiftä¸­æ·»åŠ <code>import DataKit</code>ï¼Œæ›¿æ¢æ‰ä¸­çš„<code>application(application, didFinishLaunchingWithOptions) -&gt; Bool</code>æ–¹æ³•ä¸­<code>controller.managedObjectContext = managedObjectContext</code>ä¸º<code>controller.managedObjectContext = DataAccess.sharedInstance.managedObjectContext</code>ï¼Œä¹Ÿå°±æ˜¯ä¸å†ä½¿ç”¨ä»¥å‰çš„æ¨¡æ¿ä»£ç ä¸­çš„ä¸Šä¸‹æ–‡å®ä¾‹ï¼Œè€Œæ˜¯ç”¨DataAccesså•ä¾‹ä¸­çš„<code>managedObjectContext</code>ã€‚  </p>
<p>åŒç†ï¼Œ<code>applicationWillTerminate(application)</code>æ–¹æ³•ä¸­çš„<code>saveContext()</code>ä¹Ÿè¦æ›¿æ¢æˆ<code>DataAccess.sharedInstance.saveContext()</code>ã€‚  </p>
<p>äºæ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨App Extensionsä¸­importè¿›æ¥DataKitï¼Œè¿›è¡Œåœ°å­˜å–Core Dataä¸­çš„æ•°æ®å•¦ã€‚è€Œä¸”ç”¨çš„æ˜¯åŒä¸€æ®µä»£ç ï¼ŒåŒä¸€å—æ•°æ®ã€‚ç®€ç›´æ˜¯åŒä¸€ä¸ªä¸–ç•Œï¼ŒåŒä¸€ä¸ªæ¢¦æƒ³å•Šã€‚  </p>
<p>##Container app ä¸ Extensionçš„é€šä¿¡  </p>
<p>è¦çŸ¥é“ä¹‹å‰åšçš„å…±äº«æ•°æ®åªèƒ½æ˜¯ä¸»åŠ¨è·å–æ•°æ®ï¼Œå¹¶ä¸èƒ½åœ¨æ•°æ®å˜åŒ–æ—¶å®æ—¶è·å–é€šçŸ¥ã€‚å¦‚æœç”¨æˆ·åœ¨iPhoneä¸Šæ›´æ”¹äº†æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ï£¿Watchä¸Šå®æ—¶æ›´æ”¹ç•Œé¢ä¸Šæ•°æ®çš„æ˜¾ç¤ºã€‚è¿™ç‚¹<code>NSNotificationCenter</code>æ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºå®ƒåªåœ¨Appå†…éƒ¨å·¥ä½œè€Œä¸ä¼šåœ¨ä¸¤ä¸ªAppä¹‹é—´å‘é€šçŸ¥ã€‚åŒæ ·KVOä¹Ÿæ— èƒ½ä¸ºåŠ›ï¼Œè‡ªå·±æ‰‹å†™å§”æ‰˜ä»€ä¹ˆçš„æ›´æ˜¯åˆ«æƒ³äº†(å› ä¸ºæˆ‘è¯•è¿‡äº†)ã€‚ç›´åˆ°æˆ‘åœ¨<a href="https://medium.com/@saberjack/ios-sending-notifications-between-your-apps-3fe7422d6a41" target="_blank" rel="external">è¿™ç¯‡æ–‡ç« </a>æ‰¾åˆ°äº†æ•‘ä¸–ä¸»ï¼Œé—®é¢˜è¿åˆƒè€Œè§£ï¼š  </p>
<p>###CFNotificationCenterGetDarwinNotifyCenter</p>
<p>è¿™æ˜¯CoreFoundationåº“ä¸­ä¸€ä¸ªç³»ç»Ÿçº§çš„é€šçŸ¥ä¸­å¿ƒï¼Œè‹¹æœçš„ç³»ç»Ÿè‡ªå·±ä¹Ÿåœ¨ç”¨å®ƒï¼Œçœ‹æ¸…äº†â€Darwinâ€äº†æ²¡æœ‰ï¼Ÿå“ˆå“ˆï¼çœ‹äº†ä¸‹<code>CFNotificationCenter</code>ç›¸å…³çš„APIï¼Œè·Ÿ<code>NSNotificationCenter</code>æœ‰ç‚¹åƒã€‚éœ€è¦ç”¨åˆ°Toll-Bridgeçš„çŸ¥è¯†ä¸CoreFoundationç›¸å…³çš„ç±»è¿›è¡Œæ¡¥æ¥ï¼Œè¿™è™½ä¸å¸¸ç”¨ä½†ä¹Ÿä¸éš¾ã€‚è¿˜éœ€è¦æ³¨æ„ä¸‹ä¸ªåˆ«å‚æ•°çš„ä½¿ç”¨ã€‚  </p>
<p>###MMWormhole</p>
<p>æ›´æœ‰è¶£çš„æ˜¯å‡ ä¹åŒæ—¶æˆ‘ä¹Ÿå‘ç°äº†<a href="https://github.com/mutualmobile/MMWormhole" target="_blank" rel="external">MMWormhole</a>è¿™ä¸ªå¼€æºåº“ï¼Œå®ƒä¸“é—¨ç”¨äºåœ¨Container app ä¸ Extensioné—´ä¼ é€’æ¶ˆæ¯ã€‚æˆ‘è¯»äº†ä¸‹å®ƒçš„ä»£ç ï¼Œè™½ç„¶åªæœ‰ä¸€ä¸ªç±»ï¼Œä½†æ˜¯ä¾ç„¶å­¦åˆ°äº†å¾ˆå¤šã€‚è™½ç„¶åœ¨æˆ‘çš„<a href="https://github.com/yulingtianxia/HardChoice" target="_blank" rel="external">HardChoice</a>ä¸Šå®Œå…¨å¯ä»¥åªç”¨<code>CFNotificationCenter</code>è¿›è¡Œé€šçŸ¥å°±å¯ä»¥äº†ï¼Œå®Œå…¨ä¸éœ€è¦ä½¿ç”¨MMWormholeæ¥æŒä¹…åŒ–æ•°æ®å’Œä¼ é€’æ•°æ®ã€‚ä½†æˆ‘è§‰å¾—ä»¥åè¿˜å¯èƒ½ä¼šç”¨åˆ°MMWormholeï¼Œäºæ˜¯æˆ‘ç”¨Swift1.2é‡æ–°å†™äº†ä¸€ä¸ª<a href="https://github.com/yulingtianxia/HardChoice/blob/master/HardChoice/DataKit/Wormhole.swift" target="_blank" rel="external">Wormhole.swift</a>ï¼Œæ”¾åœ¨äº†DataKité‡Œã€‚  </p>
<p>###Swiftä¸CoreFoundation</p>
<p>åŸæ¥OCå†™çš„ä¸¤ç™¾å¤šè¡Œçš„MMWormholeè¢«æˆ‘ç”¨150è¡Œâ€œæ¸…æ–°ä¼˜é›…â€çš„Swiftä»£ç å–ä»£ã€‚ä¹‹æ‰€ä»¥æ‰“ä¸Šå¼•å·æ˜¯å› ä¸ºSwiftä¸CoreFoundationä¹‹é—´çš„æ¡¥æ¥æœ‰äº›ä¸æ„‰å¿«ã€‚å› ä¸ºCoreFoundationä¸­éƒ½æ˜¯Cçš„APIï¼ŒCä¸­çš„æŒ‡é’ˆå’Œç±»å‹è½¬æ¢å¾ˆå‡ºæ ¼ï¼Œæœ‰å®‰å…¨éšæ‚£ã€‚Swiftæ˜¯ä¸€é—¨å®‰å…¨çš„è¯­è¨€ï¼Œä½†ä¸ºäº†è°ƒç”¨ç”±å†å²åŸå› é€ æˆçš„ä¸å®‰å…¨çš„Cçš„APIï¼ŒSwiftä¸­å¼•å…¥äº†å¾ˆå¤šç±»å‹æ¥æ˜ å°„Cä¸­çš„ç±»å‹ï¼Œå‚è€ƒ<a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/InteractingWithCAPIs.html#//apple_ref/doc/uid/TP40014216-CH8-XID_11" target="_blank" rel="external">Interacting with C APIs</a>  </p>
<p>Swiftä¸­ä¸ç”¨åƒOCé‚£æ ·ä½¿ç”¨<code>__bridge</code>å’Œç±»å‹è½¬æ¢ã€å†…å­˜ç®¡ç†äº¤æ¥ï¼Œå› ä¸ºè¿™äº›å…¨éƒ½äº¤ç»™Swiftäº†ï¼šå¦‚æœSwiftä¸­å­˜åœ¨ç±»å‹æ˜ å°„åˆ°Cçš„APIæ‰€éœ€çš„å‚æ•°ç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°†å…¶ä¼ å…¥APIã€‚æ­¤å¤–å†…å­˜ç®¡ç†ä¹Ÿå½’Swiftä¸­çš„ARCç»Ÿä¸€ç®¡ç†ã€‚äºæ˜¯Swiftå¤§å¤§ç®€åŒ–äº†ä¸CoreFoundationæ‰“äº¤é“çš„è¿‡ç¨‹ã€‚  </p>
<p>æˆ‘ä»¬æœ€å…³å¿ƒçš„æ˜¯æŒ‡é’ˆï¼Œ<code>UnsafePointer&lt;SwiftType&gt;</code>å¯¹åº”äº†<code>const CType *</code>ï¼Œ<code>UnsafeMutablePointer&lt;SwiftType&gt;</code>å¯¹åº”äº†<code>CType *</code>ã€‚å½“ç„¶SwiftTypeä¸CTypeä¹Ÿæ˜¯å¯¹åº”çš„ï¼š  </p>
<table>
<thead>
<tr>
<th>C Type</th>
<th style="text-align:center">Swift Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>bool</td>
<td style="text-align:center">CBool</td>
</tr>
<tr>
<td>char, signed char</td>
<td style="text-align:center">CChar</td>
</tr>
<tr>
<td>unsigned char</td>
<td style="text-align:center">CUnsignedChar</td>
</tr>
<tr>
<td>short</td>
<td style="text-align:center">CShort</td>
</tr>
<tr>
<td>unsigned short</td>
<td style="text-align:center">CUnsignedShort</td>
</tr>
<tr>
<td>int</td>
<td style="text-align:center">CInt</td>
</tr>
<tr>
<td>unsigned int</td>
<td style="text-align:center">CUnsignedInt</td>
</tr>
<tr>
<td>long</td>
<td style="text-align:center">CLong</td>
</tr>
<tr>
<td>unsigned long</td>
<td style="text-align:center">CUnsignedLong</td>
</tr>
<tr>
<td>long long</td>
<td style="text-align:center">CLongLong</td>
</tr>
<tr>
<td>unsigned long long</td>
<td style="text-align:center">CUnsignedLongLong</td>
</tr>
<tr>
<td>wchar_t</td>
<td style="text-align:center">CWideChar</td>
</tr>
<tr>
<td>char16_t</td>
<td style="text-align:center">CChar16</td>
</tr>
<tr>
<td>char32_t</td>
<td style="text-align:center">CChar32</td>
</tr>
<tr>
<td>float</td>
<td style="text-align:center">CFloat</td>
</tr>
<tr>
<td>double</td>
<td style="text-align:center">CDouble</td>
</tr>
</tbody>
</table>
<p>æ›´å¤šçš„è½¬æ¢è§„åˆ™ï¼Œåœ¨ä¸Šé¢æåˆ°çš„å®˜æ–¹æ–‡æ¡£æœ‰å¾ˆè¯¦ç»†çš„æè¿°ï¼Œè¿™é‡Œåªè¯´ä¸‰ä¸ªtipsï¼š  </p>
<ol>
<li>åœ¨Swiftä¸­å°†<code>self</code>è½¬æˆ<code>UnsafePointer&lt;Void&gt;</code>(ä¹Ÿå°±æ˜¯<code>const void *</code>)åªéœ€ç”¨è¿™ä¸ªå‡½æ•°ï¼š<code>unsafeAddressOf(self)</code>  </li>
<li>CoreFoundationåº“ä¸­åç¼€ä¸ºâ€Refâ€çš„ç±»åœ¨Swiftä¸­å·²ç»å»æ‰åç¼€ã€‚  </li>
<li>Swiftä¸­å‡½æ•°æŒ‡é’ˆè¢«è¡¨ç¤ºä¸º<code>CFunctionPointer&lt;Type&gt;</code>ï¼ŒTypeå°±æ˜¯å‡½æ•°çš„ç±»å‹ï¼Œä½†è¿˜ä¸å…è®¸ä½ å°†Swiftå†™çš„å‡½æ•°æˆ–é—­åŒ…è½¬åŒ–æˆ<code>CFunctionPointer</code>ï¼Œä¹Ÿå°±æ˜¯å¹²è„†æ²¡æä¾›å»ºç«‹<code>CFunctionPointer</code>å®ä¾‹çš„æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡å¤–éƒ¨å¼•å…¥Cçš„å‡½æ•°ã€‚è¿™å°±æ¶‰åŠåˆ°äº†Swiftä¸OCæ··ç¼–ï¼Œè¯·æˆ³<a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html#//apple_ref/doc/uid/TP40014216-CH10-XID_77" target="_blank" rel="external">Swift and Objective-C in the Same Project</a>  </li>
</ol>
<p>###åœ¨Frameworkä¸­æ··ç¼–OC</p>
<p>æˆ‘ä¹‹æ‰€ä»¥éœ€è¦åšè¿™ç§ç ´åå·¥ç¨‹çº¯æ´æ€§çš„äº‹å„¿ï¼Œæ˜¯å› ä¸ºè¦ç”¨åˆ°ä¸‹é¢è¿™ä¸ªæ–¹æ³•æ¥å¯¹é€šçŸ¥è¿›è¡Œè§‚å¯Ÿï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">func CFNotificationCenterAddObserver(center: CFNotificationCenter!, observer: UnsafePointer&lt;Void&gt;, callBack: CFNotificationCallback, name: CFString!, object: UnsafePointer&lt;Void&gt;, suspensionBehavior: CFNotificationSuspensionBehavior)</div></pre></td></tr></table></figure>
<p>é™¤äº†ç±»å‹ä¸º<code>CFNotificationCallback</code>çš„å‚æ•°ï¼Œå…¶ä½™çš„éƒ½å¥½è¯´ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">typealias CFNotificationCallback = CFunctionPointer&lt;((CFNotificationCenter!, UnsafeMutablePointer&lt;Void&gt;, CFString!, UnsafePointer&lt;Void&gt;, CFDictionary!) -&gt; Void)&gt;</div></pre></td></tr></table></figure>
<p>äºæ˜¯å°±å›åˆ°äº†<code>CFunctionPointer</code>è¿™å—è›‹ç–¼åœ°ä¸Šäº†ï¼Œåªå¥½åœ¨OCé‡Œå†™Cå‡½æ•°ç„¶åè°ƒç”¨ä¹‹ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">static NSString * const WormholeNotificationName = @&quot;WormholeNotificationName&quot;;</div><div class="line">@implementation HelpMethod</div><div class="line">- (instancetype)init</div><div class="line">&#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        _callback = wormholeNotificationCallback;</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line">void wormholeNotificationCallback(CFNotificationCenterRef center,</div><div class="line">                                  void * observer,</div><div class="line">                                  CFStringRef name,</div><div class="line">                                  void const * object,</div><div class="line">                                  CFDictionaryRef userInfo) &#123;</div><div class="line">    NSString *identifier = (__bridge NSString *)name;</div><div class="line">    [[NSNotificationCenter defaultCenter] postNotificationName:WormholeNotificationName</div><div class="line">                                                        object:nil</div><div class="line">                                                      userInfo:@&#123;@&quot;identifier&quot; : identifier&#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨Swiftä¸­è¿™æ ·å†™å°±å¯ä»¥äº†ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CFNotificationCenterAddObserver(center, unsafeAddressOf(self), helpMethod.callback, identifier, nil, CFNotificationSuspensionBehavior.DeliverImmediately)</div></pre></td></tr></table></figure>
<p>åœ¨Swiftä¸­ä½¿ç”¨OCå†™çš„ç±»æœ¬æ¥æ˜¯ä¸€ä»¶å¾ˆeasyçš„äº‹å„¿ï¼Œä½†æ˜¯åˆ°äº†Frameworkä¸­å°±å˜å¾—ä¸å¯»å¸¸ã€‚æˆ‘åœ¨DataKitä¸­æ–°å»ºäº†<code>HelpMethod</code>ç±»ï¼Œå¹¶å»ºç«‹â€DataKit-Bridging-Header.hâ€æ–‡ä»¶ï¼Œå°†HelpMethod.hå¤´æ–‡ä»¶å¼•å…¥ï¼Œç„¶ååœ¨DataKit targetä¸‹çš„â€Build Settingsâ€ -&gt; â€œSwift Complier-Code Generationâ€ -&gt; â€œObjective-C Bridging Headerâ€ä¸‹å¡«å…¥â€DataKit-Bridging-Header.hâ€ï¼Œç¼–è¯‘å‡ºé”™ï¼š<strong>using bridging headers with framework targets is unsupported</strong>ã€‚  </p>
<p>åœ¨stackoverflowä¸Šæ‰¾åˆ°äº†<a href="http://stackoverflow.com/questions/24875745/xcode-6-beta-4-using-bridging-headers-with-framework-targets-is-unsupported" target="_blank" rel="external">è§£å†³æ–¹æ¡ˆ</a>ï¼Œäºæ˜¯åˆ é™¤ä¹‹å‰çš„â€DataKit-Bridging-Header.hâ€æ–‡ä»¶å¹¶æ¸…é™¤â€Build Settingsâ€å…³äºBridging Headerçš„å¼•ç”¨ï¼›åœ¨DataKit.hæ·»åŠ <code>#import &quot;HelpMethod.h&quot;</code>ï¼Œå¹¶åœ¨HelpMethod.hæ–‡ä»¶çš„ â€œFile inspectorâ€-&gt;â€Target Membershipâ€ä¸­DataKitå³ä¾§å°†â€projectâ€ä¿®æ”¹ä¸ºâ€publicâ€(å¦åˆ™ä¼šå‡ºç°<strong>include of non-modular header inside framework module â€˜DataKitâ€™</strong>çš„ç¼–è¯‘é”™è¯¯)ã€‚  </p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>HelpMethod</code>ç±»ä¸­å®ç°ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå¹¶åœ¨Wormhole.swiftæ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæ¥ä¸º<code>CFunctionPointer</code>ç±»å‹çš„å‚æ•°ä¼ å€¼ã€‚  </p>
<p>##æ€»ç»“</p>
<p>æ¥ä¸ªæ•ˆæœå›¾ï¼š  </p>
<p><img src="http://7ni3rk.com1.z0.glb.clouddn.com/hardchoice.gif" alt="">  </p>
<p>è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™ï£¿Watchçš„App(åºŸè¯è°ä¸æ˜¯ç¬¬ä¸€æ¬¡)ï¼Œç»éªŒå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œä¹Ÿå› ä¸ºSwift1.2è¿˜æœªæ­£å¼å‘å¸ƒï¼Œé‡åˆ°äº†ä¸€äº›å‘ã€‚å¥½æ­¹æœ€åå…‹æœäº†ï¼Œä½†ä¹Ÿä¸¢äº†è´æ“(æ¯•ç«Ÿä¸æ˜¯çº¯Swiftçš„Appäº†)ã€‚æœ‰ä¸å¯¹çš„åœ°æ–¹è¿˜è¯·å¤šå¤šæŒ‡æ•™ã€‚éšç€Swiftçš„ä¸æ–­å®Œå–„ï¼Œå¸Œæœ›ä»¥åèƒ½å¤Ÿæ”¯æŒåˆ›å»º<code>CFunctionPointer</code>å¯¹è±¡ï¼Œè¿™æ ·å®ƒå¥½æˆ‘ä¹Ÿå¥½ğŸ˜„</p>
</div></article><div class="pagination"><a href="/2015/04/19/AutoreleasePoolå‰–æ/" class="pagination-prev">PREV</a><a href="/2015/03/08/2015-03-08-Insight-of-Null/" class="pagination-next">NEXT</a></div><div class="comments"></div></div><aside class="sidebar"><h3>åˆ†ç±»æ ‡ç­¾</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARC/">ARC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/App-Extensions/">App Extensions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AppGroups/">AppGroups</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CocoaPods/">CocoaPods</a></li></ul><h3>æœ€æ–°æ–‡ç« </h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/10/24/ä¸€é¦–å°è¯—/">1024,ä¸€é¦–å°è¯—</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/29/ç»ˆæœ‰ä¸€å¤©/">ç»ˆæœ‰ä¸€å¤©.md</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/14/æ¨±èŠ±æ¨±èŠ±æƒ³è§ä½ /">æ¨±èŠ±æ¨±èŠ±æƒ³è§ä½ </a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/06/å·¥å…·æœ¬/">å°tipsæ±‡æ€»</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/02/CIæ­å»ºå’Œè„šæœ¬è‡ªåŠ¨åŒ–/">CIæ­å»ºå’Œè„šæœ¬è‡ªåŠ¨åŒ–</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/01/åˆè¦æ˜¥èŠ‚äº†å•Š/">åˆè¦æ˜¥èŠ‚äº†å•Š</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/å†™ç»™PMçš„iOSæ¶ˆæ¯æ¨é€/">å†™ç»™PMçš„iOSæ¶ˆæ¯æ¨é€</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/19/gitlabå’Œsourcetreeçš„ä½¿ç”¨/">gitlabå’Œsourcetreeçš„ä½¿ç”¨</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><P>Â© 2017 <a href="/">sopig</P></div><div class="power"><p><a href="http://pinggod.com/">Sean Sun</a>, 
<a href="https://hexo.io">Hexo</a>, 
<a href="https://github.com/">GitHub</a>, 
<a href="https://jekyllrb.com/">Jekyll</a></p></div></div></footer><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?38155daa8b79fb3a5cad11d825228868";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>